{"version":3,"names":["useEffect","useState","useRef","useCallback","getMostRecentWorkout","getPreferredUnitsTyped","subscribeToChanges","useMostRecentWorkout","options","workout","setWorkout","optionsRef","current","update","energyUnit","distanceUnit","cancelSubscription","init","_cancelSubscription"],"sources":["useMostRecentWorkout.ts"],"sourcesContent":["import {\n  useEffect, useState, useRef, useCallback,\n} from 'react'\n\nimport getMostRecentWorkout from '../utils/getMostRecentWorkout'\nimport getPreferredUnitsTyped from '../utils/getPreferredUnitsTyped'\nimport subscribeToChanges from '../utils/subscribeToChanges'\n\nimport type { EnergyUnit, LengthUnit } from '../native-types'\nimport type { HKWorkout } from '../types'\n\nfunction useMostRecentWorkout<\n  TEnergy extends EnergyUnit,\n  TDistance extends LengthUnit\n>(options?: { readonly energyUnit?: TEnergy; readonly distanceUnit?: TDistance }) {\n  const [workout, setWorkout] = useState<HKWorkout<TEnergy, TDistance> | null>(null)\n\n  const optionsRef = useRef(options)\n\n  useEffect(() => {\n    optionsRef.current = options\n  }, [options])\n\n  const update = useCallback(async () => {\n    const { energyUnit, distanceUnit } = await getPreferredUnitsTyped(\n      optionsRef.current,\n    )\n\n    setWorkout(await getMostRecentWorkout({\n      energyUnit,\n      distanceUnit,\n    }))\n  }, [])\n\n  useEffect(() => {\n    void update()\n  }, [update])\n\n  useEffect(() => {\n    let cancelSubscription: (() => Promise<boolean>) | undefined\n\n    const init = async () => {\n      cancelSubscription = await subscribeToChanges(\n        'HKWorkoutTypeIdentifier',\n        update,\n      )\n    }\n    void init()\n\n    return () => {\n      void cancelSubscription?.()\n    }\n  }, [update])\n\n  return workout\n}\n\nexport default useMostRecentWorkout\n"],"mappings":"AAAA,SACEA,SAAS,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,WAAW,QACnC,OAAO;AAEd,OAAOC,oBAAoB,MAAM,+BAA+B;AAChE,OAAOC,sBAAsB,MAAM,iCAAiC;AACpE,OAAOC,kBAAkB,MAAM,6BAA6B;AAK5D,SAASC,oBAAoBA,CAG3BC,OAA8E,EAAE;EAChF,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGT,QAAQ,CAAuC,IAAI,CAAC;EAElF,MAAMU,UAAU,GAAGT,MAAM,CAACM,OAAO,CAAC;EAElCR,SAAS,CAAC,MAAM;IACdW,UAAU,CAACC,OAAO,GAAGJ,OAAO;EAC9B,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAEb,MAAMK,MAAM,GAAGV,WAAW,CAAC,YAAY;IACrC,MAAM;MAAEW,UAAU;MAAEC;IAAa,CAAC,GAAG,MAAMV,sBAAsB,CAC/DM,UAAU,CAACC,OACb,CAAC;IAEDF,UAAU,CAAC,MAAMN,oBAAoB,CAAC;MACpCU,UAAU;MACVC;IACF,CAAC,CAAC,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;EAENf,SAAS,CAAC,MAAM;IACd,KAAKa,MAAM,CAAC,CAAC;EACf,CAAC,EAAE,CAACA,MAAM,CAAC,CAAC;EAEZb,SAAS,CAAC,MAAM;IACd,IAAIgB,kBAAwD;IAE5D,MAAMC,IAAI,GAAG,MAAAA,CAAA,KAAY;MACvBD,kBAAkB,GAAG,MAAMV,kBAAkB,CAC3C,yBAAyB,EACzBO,MACF,CAAC;IACH,CAAC;IACD,KAAKI,IAAI,CAAC,CAAC;IAEX,OAAO,MAAM;MAAA,IAAAC,mBAAA;MACX,OAAAA,mBAAA,GAAKF,kBAAkB,cAAAE,mBAAA,uBAAlBA,mBAAA,CAAqB,CAAC;IAC7B,CAAC;EACH,CAAC,EAAE,CAACL,MAAM,CAAC,CAAC;EAEZ,OAAOJ,OAAO;AAChB;AAEA,eAAeF,oBAAoB"}