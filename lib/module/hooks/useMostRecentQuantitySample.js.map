{"version":3,"names":["useEffect","useState","ensureUnit","getMostRecentQuantitySample","subscribeToChanges","useMostRecentQuantitySample","identifier","unit","lastSample","setLastSample","cancelSubscription","init","actualUnit","value","_cancelSubscription"],"sources":["useMostRecentQuantitySample.ts"],"sourcesContent":["import { useEffect, useState } from 'react'\n\nimport ensureUnit from '../utils/ensureUnit'\nimport getMostRecentQuantitySample from '../utils/getMostRecentQuantitySample'\nimport subscribeToChanges from '../utils/subscribeToChanges'\n\nimport type { HKQuantityTypeIdentifier, UnitForIdentifier } from '../native-types'\nimport type { HKQuantitySample } from '../types'\n\nfunction useMostRecentQuantitySample<\n  TIdentifier extends HKQuantityTypeIdentifier,\n  TUnit extends UnitForIdentifier<TIdentifier>\n>(identifier: TIdentifier, unit?: TUnit) {\n  const [lastSample, setLastSample] = useState<HKQuantitySample<\n  TIdentifier\n  > | null>(null)\n\n  useEffect(() => {\n    let cancelSubscription: (() => Promise<boolean>) | undefined\n\n    const init = async () => {\n      const actualUnit = await ensureUnit(identifier, unit)\n\n      cancelSubscription = await subscribeToChanges(identifier, async () => {\n        const value = await getMostRecentQuantitySample(identifier, actualUnit)\n        setLastSample(value)\n      })\n    }\n    void init()\n\n    return () => {\n      void cancelSubscription?.()\n    }\n  }, [identifier, unit])\n\n  return lastSample\n}\n\nexport default useMostRecentQuantitySample\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE3C,OAAOC,UAAU,MAAM,qBAAqB;AAC5C,OAAOC,2BAA2B,MAAM,sCAAsC;AAC9E,OAAOC,kBAAkB,MAAM,6BAA6B;AAK5D,SAASC,2BAA2BA,CAGlCC,UAAuB,EAAEC,IAAY,EAAE;EACvC,MAAM,CAACC,UAAU,EAAEC,aAAa,CAAC,GAAGR,QAAQ,CAElC,IAAI,CAAC;EAEfD,SAAS,CAAC,MAAM;IACd,IAAIU,kBAAwD;IAE5D,MAAMC,IAAI,GAAG,MAAAA,CAAA,KAAY;MACvB,MAAMC,UAAU,GAAG,MAAMV,UAAU,CAACI,UAAU,EAAEC,IAAI,CAAC;MAErDG,kBAAkB,GAAG,MAAMN,kBAAkB,CAACE,UAAU,EAAE,YAAY;QACpE,MAAMO,KAAK,GAAG,MAAMV,2BAA2B,CAACG,UAAU,EAAEM,UAAU,CAAC;QACvEH,aAAa,CAACI,KAAK,CAAC;MACtB,CAAC,CAAC;IACJ,CAAC;IACD,KAAKF,IAAI,CAAC,CAAC;IAEX,OAAO,MAAM;MAAA,IAAAG,mBAAA;MACX,OAAAA,mBAAA,GAAKJ,kBAAkB,cAAAI,mBAAA,uBAAlBA,mBAAA,CAAqB,CAAC;IAC7B,CAAC;EACH,CAAC,EAAE,CAACR,UAAU,EAAEC,IAAI,CAAC,CAAC;EAEtB,OAAOC,UAAU;AACnB;AAEA,eAAeH,2BAA2B"}